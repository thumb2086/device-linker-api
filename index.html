async function play(choice) {
const amount = document.getElementById('bet-amount').value;
const status = document.getElementById('status-msg');
const coin = document.getElementById('main-coin');
const txLog = document.getElementById('tx-log');

status.innerHTML = `<span class="loader"></span> æ­£åœ¨é–‹çä¸­... ğŸ°`;
txLog.innerHTML = "";

// é‡ç½®ç¡¬å¹£
coin.style.transition = "none";
coin.style.transform = `rotateY(0deg)`;

try {
// ğŸš€ ç›´æ¥å‘¼å«å¾Œç«¯é–‹çï¼Œä¸éœ€è¦æ‰‹æ©Ÿç°½å
const res = await fetch('/api/coinflip', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({
address: user.address,
amount: amount,
choice: choice,
sessionId: sessionId // å¸¶ä¸Šç™»å…¥æ™‚çš„ sessionId å³å¯
})
});

const result = await res.json();

if (result.isWin !== undefined) {
// åŸ·è¡Œæ—‹è½‰å‹•ç•«
coin.style.transition = "transform 3s cubic-bezier(0.1, 0.8, 0.2, 1)";
const rotation = result.resultSide === 'heads' ? 1800 : 1980;
coin.style.transform = `rotateY(${rotation}deg)`;

setTimeout(() => {
if (result.isWin) {
status.innerText = "ğŸ† è´äº†ï¼çé‡‘å·²å…¥å¸³";
status.style.color = "#00ff88";
} else {
status.innerText = "ğŸ’€ è¼¸äº†... é¤˜é¡å·²éŠ·æ¯€";
status.style.color = "#ff4444";
}
txLog.innerHTML = `<a href="https://sepolia.etherscan.io/tx/${result.txHash}" target="_blank">æŸ¥çœ‹å€å¡Šéˆè­‰æ˜</a>`;
}, 3100);
} else {
status.innerText = "å¤±æ•—: " + result.error;
}
} catch (e) {
status.innerText = "ç¶²è·¯éŒ¯èª¤";
}
}